<!DOCTYPE html>
<html>
  <head>
    <title>Twittler</title>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>  
    <link type="text.css" rel="stylesheet" href="stylesheet.css"/>
  </head>
  <body>
    <script>

      $(document).ready(function(){
      var $body = $('body');
      var $messages = $('.messages');

      var tweeted = 0;
      var toDisplay = 0; 
      var index = 0
      var upTo = streams.home.length - 1;
     
      
      function displayNewMessages() {
        checkMessages();
        var index = (streams.home.length - toDisplay);
        while(index <= (streams.home.length - 1)) { 
          var tweet = streams.home[index];
          //var $tweet = $('<div id="tweetlist"></div>');
          //$tweet.text(index + tweet.created_at + '@' + tweet.user + ': ' + tweet.message);
          //$tweet.appendTo($body);
          $messages.append("<div id='tweetlist'>" + tweet.created_at + "<a href='#' class='filter'>" + tweet.user + "</a>: " + tweet.message + "</div>");
          index ++;
          tweeted++;
        }
      };

      function checkMessages() {
        toDisplay = streams.home.length - tweeted;
        return toDisplay;
      };

      // function showTimeline() { 
      // 	console.log(streams.users[user]);
      // 	$body.append("div id='timeline'>" + streams.users[user] + "</div>");
      // }
      
      //setInterval(displayNewMessages, 5000);

      //loads new messages
      $('button.load').on('click', displayNewMessages);

      //$(document).on('click', '.filter', showTimeline);

      $(document).on('click', '.filter', function() {
      	$messages.hide();
      	//var htmlString = $(this).get().innerHTML;
      	var user = $(this).text();
      	//console.log(user);
      	//console.log(streams.users[user]);
      	for (var i = 0; i < streams.users[user].length; i++) {
      	  $('.userline').append("div id='timeline'>" + streams.users[user][i] + "</div>");
      	}
      });

      //to return home after viewing a timeline
      $(document).on('click', '.refresh', function() {
        $('.userline').hide();
      	$messages.show();
      });

      //prints user's message
      $('button.send').on('click', function() {
        var input = $('.usertweet').val();
        //var userchirp = "You: " + input;
        //var $userchirp = $('<div id=chirplist"></div>');
        //$userchirp.text(userchirp);
        //$userchirp.appendTo($body)
        $body.append("<div id='chirplist'>" + Date.now() + " You: " + input + "</div>");
      })

      //allows user to send message with "enter" instead of button click
      $('.usertweet').on('keypress', function(event) {
        if (event.keyCode == 13) {
          $('button.send').click()
        }
      })
    

      });

    </script>

    <div id="topbar">
      <ul>
        <li> <a href='#' class='refresh'>Home</a><li>
        <li>Notifications</li>
        <li>Discover</li>
        <li>Me</li>
      </ul>
    </div>

    <h2>TWITTLER</h2>
    
    <div class="chatterbox">
      <input class="usertweet" type="text" placeholder="enter chirp!"/>
      <button class="send">send tweet</button>
      <button class="load">load more tweets</button>
    </div>

    <div class="container">
      <ul class="messages"></ul>
      <ul class="userline"></ul>
    </div>


  </body>
</html>
